<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Open-World Snake RPG</title>
<style>
  :root{--bg:#000;--fg:#fff;}
  html,body{margin:0;padding:0;height:100%;background:var(--bg);color:var(--fg);font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;overflow:hidden;}
  canvas{border:2px solid #fff; display:block; background:#111;}
  .hud{position:absolute;top:10px;left:10px;color:white;font-size:16px;}
</style>
</head>
<body>
<canvas id="game" width="600" height="400" tabindex="0"></canvas>
<div class="hud" id="hud"></div>

<script>
(() => {
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const hud = document.getElementById('hud');

const CELL = 20;
const VIEW_WIDTH = Math.floor(canvas.width / CELL);
const VIEW_HEIGHT = Math.floor(canvas.height / CELL);

const MAP_WIDTH = 50;
const MAP_HEIGHT = 50;

let player = {x: 25, y: 25, skin: 'white'};
let points = 0;
let ownedSkins = ['white'];
let items = [];
let npcs = [];
let quests = [];
let keys = {};

// Generate items (like food)
for(let i=0;i<50;i++){
    items.push({x:Math.floor(Math.random()*MAP_WIDTH), y:Math.floor(Math.random()*MAP_HEIGHT), type:'apple'});
}

// Generate NPCs
npcs.push({x:10,y:10,name:'Bob',quest:'Collect 5 apples',questItem:'apple',questCount:5,completed:false});
npcs.push({x:40,y:35,name:'Alice',quest:'Find the golden skin',questItem:'gold',questCount:1,completed:false});

// Camera
let camera = {x:0, y:0};

// Handle keys
window.addEventListener('keydown', e=>keys[e.key]=true);
window.addEventListener('keyup', e=>keys[e.key]=false);

// Game loop
function gameLoop(){
    handleMovement();
    checkItemCollision();
    updateCamera();
    draw();
    updateHUD();
    requestAnimationFrame(gameLoop);
}

// Movement
function handleMovement(){
    if(keys['ArrowUp']) player.y = Math.max(0, player.y-1);
    if(keys['ArrowDown']) player.y = Math.min(MAP_HEIGHT-1, player.y+1);
    if(keys['ArrowLeft']) player.x = Math.max(0, player.x-1);
    if(keys['ArrowRight']) player.x = Math.min(MAP_WIDTH-1, player.x+1);
}

// Check item collection
function checkItemCollision(){
    items = items.filter(item=>{
        if(item.x===player.x && item.y===player.y){
            points++;
            // Check quest progress
            quests.forEach(q=>{
                if(q.questItem===item.type && !q.completed){
                    q.collected++;
                    if(q.collected>=q.questCount) q.completed=true;
                }
            });
            return false; // remove collected item
        }
        return true;
    });
}

// Update camera
function updateCamera(){
    camera.x = player.x - Math.floor(VIEW_WIDTH/2);
    camera.y = player.y - Math.floor(VIEW_HEIGHT/2);
    camera.x = Math.max(0, Math.min(MAP_WIDTH-VIEW_WIDTH, camera.x));
    camera.y = Math.max(0, Math.min(MAP_HEIGHT-VIEW_HEIGHT, camera.y));
}

// Draw everything
function draw(){
    ctx.fillStyle='#111';
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Draw items
    items.forEach(item=>{
        const dx = (item.x - camera.x)*CELL;
        const dy = (item.y - camera.y)*CELL;
        ctx.fillStyle='red';
        ctx.fillRect(dx+2, dy+2, CELL-4, CELL-4);
    });

    // Draw NPCs
    npcs.forEach(npc=>{
        const dx = (npc.x - camera.x)*CELL;
        const dy = (npc.y - camera.y)*CELL;
        ctx.fillStyle='orange';
        ctx.fillRect(dx+2, dy+2, CELL-4, CELL-4);
    });

    // Draw player
    const px = (player.x - camera.x)*CELL;
    const py = (player.y - camera.y)*CELL;
    ctx.fillStyle = player.skin;
    ctx.fillRect(px+1, py+1, CELL-2, CELL-2);
}

// HUD
function updateHUD(){
    let hudText = `Points: ${points}<br>`;
    hudText += `Skins: ${ownedSkins.join(', ')}<br>`;
    npcs.forEach(npc=>{
        if(Math.abs(player.x-npc.x)<=1 && Math.abs(player.y-npc.y)<=1){
            hudText += `${npc.name}: ${npc.quest} ${npc.completed ? "(Completed)" : ""}<br>`;
        }
    });
    hud.innerHTML = hudText;
}

// Start game
gameLoop();

})();
</script>
</body>
</html>
